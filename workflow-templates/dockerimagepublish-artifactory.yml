## This workflow will build and deploy docker image into sherwin artifactory i.e https://artifactory.sherwin.com. 
## Before committing the workflow file update the runs-on from ubuntu-latest to sw-ubuntu-latest
name: dockerimagepublish-artifactory
on: 
  [workflow_dispatch, push]
jobs:
  job:
    runs-on: ubuntu-latest
    steps:
    -   
        name: Log in to artifactory Docker Registry
        uses: docker/login-action@v1
        with:
          registry: ${{secrets.ARTIFACTORY_DOCKER_REGISTRY}}
          username: ${{ secrets.ARTIFACTORY_DOCKER_USERNAME}}
          password: ${{ secrets.ARTIFACTORY_DOCKER_API_KEY }}
    -
       name: convert reponame to lowercase
       id: lowercasereponame
       run: |
         repoName=`echo "${{github.repository}}" | tr '[:upper:]' '[:lower:]'`
         echo "::set-output name=git_repo_name::${repoName}"
    - 
        name: Build and publish container image
        uses: docker/build-push-action@v2
        with:
          push: true
          tags: |
            ${{secrets.DOCKER_REGISTRY}}/${{ steps.lowercasereponame.outputs.git_repo_name }}:${{ github.RUN_NUMBER }}
            ${{secrets.DOCKER_REGISTRY}}/${{ steps.lowercasereponame.outputs.git_repo_name }}:latest
